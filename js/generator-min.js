var max_post_size=8388608;function setupButtons(){document.getElementById("artsubmit").addEventListener("click",(function(e){e.preventDefault();var t=getFormData();if(t.djimage.size>0){if(t.djimage.size>745373)return M.toast({html:"ERROR: Please use an image smaller than 745kb"}),!1;convertImageToBase64(t.djimage)}else postFormToServer(t,!1)})),document.getElementById("base64-art").addEventListener("click",(function(e){return e.preventDefault(),!1})),document.getElementById("copy-base64").addEventListener("click",(function(e){e.preventDefault(),copyToClipboard()})),document.getElementById("download").addEventListener("click",(function(e){e.preventDefault();var t=document.getElementById("base64-art").value;if(!t)return!1;downloadBase64File(t,"albumart.jpg"),M.toast({html:"Download triggered!"})}))}function copyToClipboard(){var e=document.getElementById("base64-art");if(!e.value)return!1;e.select(),e.setSelectionRange(0,99999),navigator.clipboard.writeText(e.value),M.toast({html:"Image Base64 copied to clipboard"})}function convertImageToBase64(e){var t=document.getElementById("converter-img");if(e.size>0){var n=new FileReader;n.onload=function(e){t.src=e.target.result,postFormToServer(getFormData(),!0)},n.readAsDataURL(e)}}function getFormData(){var e=document.getElementById("djcreds"),t=new FormData(e);return Object.fromEntries(t)}function postFormToServer(e,t){lockForLoading();let n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");n.onreadystatechange=function(){if(4===this.readyState&&200===this.status&&this.responseText){var e=document.getElementById("art-preview"),t=JSON.parse(this.responseText);e.src=t.img,document.getElementById("base64-art").value=t.img,unlockForLoading()}};var o="";t&&(o=document.getElementById("converter-img").src);var a="payload="+encodeURIComponent(JSON.stringify({id:e.templateid,text1:encodeURIComponent(e.text1),text2:encodeURIComponent(e.text2),text3:encodeURIComponent(e.text3),text4:encodeURIComponent(e.text4),img:encodeURIComponent(o)}));if(a.length>max_post_size)return M.toast({html:"ERROR: Data transfer too big. Try using a smaller image."}),unlockForLoading(),!1;n.open("POST","/generate.php",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(a)}function downloadBase64File(e,t){const n=e,o=document.createElement("a");o.href=n,o.download=t,o.click(),o.remove()}function lockForLoading(){document.getElementsByTagName("body")[0].classList.add("loading");var e=document.getElementsByTagName("button");for(let t=0;t<e.length;t++)e[t].disabled=!0;var t=document.getElementsByTagName("input");for(let e=0;e<t.length;e++)t[e].disabled=!0;var n=document.getElementsByClassName("btn");for(let e=0;e<n.length;e++)n[e].classList.add("disabled")}function unlockForLoading(){document.getElementsByTagName("body")[0].classList.remove("loading");var e=document.getElementsByTagName("button");for(let t=0;t<e.length;t++)e[t].removeAttribute("disabled");var t=document.getElementsByTagName("input");for(let e=0;e<t.length;e++)t[e].removeAttribute("disabled");var n=document.getElementsByClassName("btn");for(let e=0;e<n.length;e++)n[e].classList.remove("disabled")}document.addEventListener("DOMContentLoaded",(function(){setupButtons()}));