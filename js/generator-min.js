var max_post_size=8388608;function setupButtons(){document.getElementById("artsubmit").addEventListener("click",(function(e){e.preventDefault(),doPost()})),document.getElementById("base64-art").addEventListener("click",(function(e){return e.preventDefault(),!1})),document.getElementById("copy-base64").addEventListener("click",(function(e){e.preventDefault(),copyToClipboard()})),document.getElementById("download").addEventListener("click",(function(e){e.preventDefault();var t=document.getElementById("base64-art").value;if(!t)return!1;downloadBase64File(t,generateFileName()+".jpg"),M.toast({html:"Download triggered!"})}));var e=document.querySelectorAll("select");M.FormSelect.init(e,{});document.getElementById("dotoday").addEventListener("click",(function(e){e.preventDefault();var t=document.getElementById("text3"),n=t.placeholder;t.value=n,M.toast({html:"Today date populated!"})})),document.getElementById("upcomingshows").addEventListener("change",(function(e){updateFormFromUpcomingShow()}))}function isLocalImgPDF(){return document.getElementsByTagName("body")[0].classList.contains("localimgpdf")}function doPostBase64(){var e=getFormData();if(e.djimage.size>0){if(e.djimage.size>745373)return M.toast({html:"ERROR: Please use an image smaller than 745kb"}),!1;convertImageToBase64(e.djimage)}else postFormToServer(e,!1)}function doPostFileUpload(){var e=getFormData();if(e.djimage.size>0){if(e.djimage.size>6e6)return M.toast({html:"ERROR: Please use an image smaller than 6MB"}),!1;postFormToServer(e,!0)}else postFormToServer(e,!1)}function doPost(){"undefined"!=typeof localimgpdf&&localimgpdf?doPostFileUpload():doPostBase64()}function copyToClipboard(){var e=document.getElementById("base64-art");if(!e.value)return!1;e.select(),e.setSelectionRange(0,99999),navigator.clipboard.writeText(e.value),M.toast({html:"Image Base64 copied to clipboard"})}function convertImageToBase64(e){var t=document.getElementById("converter-img");if(e.size>0){var n=new FileReader;n.onload=function(e){t.src=e.target.result,postFormToServer(getFormData(),!0)},n.readAsDataURL(e)}}function getFormData(){var e=document.getElementById("djcreds"),t=new FormData(e);return Object.fromEntries(t)}function postFormToServer(e,t){lockForLoading();var n=isLocalImgPDF();let o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");o.onreadystatechange=function(){if(4===this.readyState&&200===this.status&&this.responseText){var e=document.getElementById("art-preview"),t=JSON.parse(this.responseText);e.src=t.img,document.getElementById("base64-art").value=t.img,unlockForLoading()}};var a="",r=!1;t&&!n?a=document.getElementById("converter-img").src:t&&n&&(r=document.getElementById("djimage").files[0]);var d=encodeURIComponent(JSON.stringify({id:e.templateid,text1:encodeURIComponent(e.text1),text2:encodeURIComponent(e.text2),text3:encodeURIComponent(e.text3),text4:encodeURIComponent(e.text4),img:encodeURIComponent(a)})),i=new FormData;if(i.append("payload",d),r&&i.append("file",r),d.length>max_post_size)return M.toast({html:"ERROR: Data transfer too big. Try using a smaller image."}),unlockForLoading(),!1;o.open("POST","generate.php",!0),o.send(i)}function downloadBase64File(e,t){const n=e,o=document.createElement("a");o.href=n,o.download=t,o.click(),o.remove()}function lockForLoading(){document.getElementsByTagName("body")[0].classList.add("loading");var e=document.getElementsByTagName("button");for(let t=0;t<e.length;t++)e[t].disabled=!0;var t=document.getElementsByTagName("input");for(let e=0;e<t.length;e++)t[e].disabled=!0;var n=document.getElementsByClassName("btn");for(let e=0;e<n.length;e++)n[e].classList.add("disabled")}function unlockForLoading(){document.getElementsByTagName("body")[0].classList.remove("loading");var e=document.getElementsByTagName("button");for(let t=0;t<e.length;t++)e[t].removeAttribute("disabled");var t=document.getElementsByTagName("input");for(let e=0;e<t.length;e++)t[e].removeAttribute("disabled");var n=document.getElementsByClassName("btn");for(let e=0;e<n.length;e++)n[e].classList.remove("disabled")}function addDJsToDropdown(e){for(var t=document.getElementById("upcomingshows"),n=t.innerHTML,o=0;o<e.length;o++)n+='<option value="'+e[o].cleanname+'" data-timerange="'+e[o].timerange+'" data-showdate="'+e[o].showdate+'">'+e[o].name+"</option>\n\r";t.innerHTML=n,t.removeAttribute("disabled");M.FormSelect.init(t,{})}function updateFormFromUpcomingShow(){var e=document.getElementById("upcomingshows"),t=e.options[e.selectedIndex];if(!t.value)return!1;var n=t.innerText,o=t.getAttribute("data-showdate"),a=t.getAttribute("data-timerange"),r=document.getElementById("text1"),d=document.getElementById("text3"),i=document.getElementById("text4");r.value=n,d.value=o,i.value=a,doPost()}function getNextShows(){let e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=function(){4===this.readyState&&200===this.status&&(this.responseText&&addDJsToDropdown(JSON.parse(this.responseText)))},e.open("GET","getnextshows.php",!0),e.send()}function generateCleanName(e){return!(void 0===e||!e)&&e.replace(/ /g,"_").replace(/[^a-zA-Z0-9\-_]/g,"")}function generateFileName(){var e=getFormData(),t=generateCleanName(e.text1),n=generateCleanName(e.text3);return(t=t||"noname")+"_"+(n=n||"nodate")+"_Sub_FM"}document.addEventListener("DOMContentLoaded",(function(){setupButtons(),getNextShows()}));